<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0">
  <title>interface-de-pagamento</title>
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:700,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="css/standardize.css">
  <link rel="stylesheet" href="css/interface-de-pagamento-grid.css">
  <link rel="stylesheet" href="css/interface-de-pagamento.css">
</head>
<body class="body page-interface-de-pagamento clearfix">
  <div class="element element-1 clearfix">
    <div class="element element-2 clearfix">
      <p class="text text-1">Terminal de pagamento</p>
      <div class="container container-1 clearfix">
        <p class="metodopagamento text text-2">Dinheiro</p>
        <button class="_button _button-1">Confirma</button>
        <div class="container container-2 clearfix">
          <div class="container container-3">
            <div class="camponomeprop text text-3">
              <p>Valor&nbsp;</p>
              <p>Total</p>
</div>
            <p id="valorTotal" class="text text-4"></p>
          </div>
          <div class="container container-4">
            <p class="camponomeprop text text-5">Valor em dinheiro</p>
            <!-- <p class="text text-6">R$10,00</p> -->
            <input id="valorInput" class="text text-6"/>
          </div>
          <div class="container container-5">
            <p class="camponomeprop text text-7">Troco</p>
            <p id="troco" class="text text-8"></p>
          </div>
        </div>
      </div>
      <div class="container container-6 clearfix">
        <p class="metodopagamento text text-9">Cart√£o</p>
        <button class="_button _button-2">Debito</button>
        <button class="_button _button-3">Credito</button>
        <div class="container container-7">
          <p class="text text-10">Bandeira</p>
          <div class="element _element element-3"></div>
          <div class="element _element element-4"></div>
          <div class="element _element element-5"></div>
          <div class="element _element element-6"></div>
          <div class="element _element element-7"></div>
        </div>
        <button class="_button _button-4">Confirma</button>
      </div>
    </div>
  </div>
</body>
</html>

<script src="../js/jquery-min.js"></script>
<script type="text/javascript">

var itemKey;
var id;

$(document).ready(function(){
  getValorTotal(getIdUsuario());
})

function getIdUsuario(){
  var refe = firebase.database().ref('caixas/');
  refe.child('caixa_1').get();
}

function getValorTotal (idUser = 5)
{
  var settings = {
  "async": true,
  "crossDomain": true,
  "url": "https://scan-skip-carrinho.herokuapp.com/id="+idUser+"/",
  "method": "GET"
}

  valor = 0;
  
  $.ajax(settings).done(function (response) {
    console.log(response);
    try
    {
      valor = response.total;
      console.log(valor);
      $("#valorTotal").text(valor);
    }
    catch(err)
    {
      valor = "NA";
    }
  });
}

  $("#valorInput").change(function(){
    valorTotal = $("#valorTotal").text()
    valorTotal = valorTotal.match(/\d+\,\d+/)[0].replace(",",".");
    valorPago = $("#valorInput").val().replace(",",".");;
    troco = valorPago - valorTotal;
    console.log(valorTotal);
    console.log(valorPago);
    console.log(troco);
    $("#troco").text(("R$ " + troco).replace(".",","));
  })

</script>
